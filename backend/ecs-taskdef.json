{
  "family": "sanmarino-backend",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "cpu": "512",
  "memory": "1024",
  "runtimePlatform": {
    "cpuArchitecture": "X86_64",
    "operatingSystemFamily": "LINUX"
  },
  "executionRoleArn": "arn:aws:iam::<ACCOUNT_ID>:role/ecsTaskExecutionRole",
  "taskRoleArn": "arn:aws:iam::<ACCOUNT_ID>:role/ecsTaskAppRole",
  "containerDefinitions": [
    {
      "name": "api",
      "image": "<ACCOUNT_ID>.dkr.ecr.us-east-2.amazonaws.com/sanmarino/backend-api:prod",
      "essential": true,
      "portMappings": [
        { "containerPort": 5002, "protocol": "tcp" }
      ],
      "environment": [
        { "name": "ASPNETCORE_ENVIRONMENT", "value": "Production" },
        { "name": "ASPNETCORE_URLS", "value": "http://+:5002" },
        { "name": "PORT", "value": "5002" },

        { "name": "ConnectionStrings__ZooSanMarinoContext", "value": "Host=sanmarinoapp.cfs22w804e5g.us-east-2.rds.amazonaws.com;Port=5432;Username=postgres;Password=123456789;Database=sanmarinoapp;SSL Mode=Require;Trust Server Certificate=true;Timeout=15;Command Timeout=30" },

        { "name": "JwtSettings__Key", "value": "u8X3hG5sPq7Lz0VwY2N4Rb6Tf9Jk1CmH" },
        { "name": "JwtSettings__Issuer", "value": "ZooSanMarinoAPI" },
        { "name": "JwtSettings__Audience", "value": "ZooSanMarinoClient" },
        { "name": "JwtSettings__DurationInMinutes", "value": "60" },

        { "name": "Database__RunMigrations", "value": "false" },
        { "name": "Database__RunSeed", "value": "false" }
      ],
      "healthCheck": {
        "command": ["CMD-SHELL", "wget -qO- http://localhost:5002/health || exit 1"],
        "interval": 30,
        "timeout": 5,
        "retries": 3,
        "startPeriod": 15
      },
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-group": "/ecs/sanmarino-backend",
          "awslogs-region": "us-east-2",
          "awslogs-stream-prefix": "api"
        }
      }
    }
  ]
}
