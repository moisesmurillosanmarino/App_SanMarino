<!-- src/app/features/db-studio/pages/explorer/explorer.page.html -->
<div class="ux-page" [attr.aria-busy]="loading() ? 'true' : null">
  <header class="ux-header">
    <h1>DB Studio — Explorador</h1>
    <a routerLink="/db-studio/query" class="btn-secondary">Consola SELECT</a>
  </header>

  <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
    <!-- Esquemas -->
    <section class="ux-card lg:col-span-2">
      <h2 class="ux-card__title">Esquemas</h2>
      <ul class="list">
        <li *ngFor="let sc of schemas()"
            [class.active]="sc.name === selectedSchema()"
            (click)="selectSchema(sc.name)">
          <span>{{ sc.name }}</span>
          <small class="muted">{{ sc.tables }}</small>
        </li>
      </ul>
    </section>

    <!-- Tablas -->
    <section class="ux-card lg:col-span-4">
      <div class="flex justify-between items-center">
        <h2 class="ux-card__title">Tablas ({{ selectedSchema() }})</h2>
        <button class="btn-primary" (click)="goCreateTable()" title="Crear tabla">+ Crear</button>
      </div>
      <ul class="list tables">
        <li *ngFor="let t of tables()"
            [class.active]="t.name === selectedTable()"
            (click)="selectTable(t.name)">
          <div>
            <strong>{{ t.name }}</strong>
            <small class="muted">{{ t.kind }}</small>
          </div>
          <small class="muted">~ {{ t.rows | number }}</small>
        </li>
      </ul>
    </section>

    <!-- Columnas -->
    <section class="ux-card lg:col-span-3" *ngIf="selectedTable()">
      <div class="flex justify-between items-center">
        <h2 class="ux-card__title">Columnas — {{ selectedTable() }}</h2>
        <button class="btn-outline" (click)="$event.preventDefault()" title="Agregar columna (próximo paso)">+ Columna</button>
      </div>
      <table class="ux-table">
        <thead>
          <tr><th>Nombre</th><th>Tipo</th><th>Null</th><th>PK</th><th>Default</th></tr>
        </thead>
        <tbody>
          <tr *ngFor="let c of columns()">
            <td><code>{{ c.name }}</code></td>
            <td>{{ c.dataType }}</td>
            <td>{{ c.isNullable ? 'Sí' : 'No' }}</td>
            <td>{{ c.isPrimaryKey ? 'PK' : '' }}</td>
            <td><small class="muted">{{ c.default || '' }}</small></td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Preview -->
    <section class="ux-card lg:col-span-3" *ngIf="previewPage() as page">
      <h2 class="ux-card__title">Preview</h2>
      <div class="table-scroll" *ngIf="page.rows.length; else noData">
        <table class="ux-table">
          <thead>
            <tr>
              <th *ngFor="let k of keys(page.rows[0])">{{ k }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let r of page.rows">
              <td *ngFor="let k of keys(page.rows[0])">
                {{ (r[k] ?? '') | json }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <ng-template #noData><p class="muted">Sin datos.</p></ng-template>

      <div class="pager">
        <button class="btn-outline" (click)="pagePrev()" [disabled]="offset() === 0">Anterior</button>
        <span>offset {{ offset() }} • {{ page.rows.length }} filas</span>
        <button class="btn-outline" (click)="pageNext()" [disabled]="page.rows.length < limit()">Siguiente</button>
      </div>
    </section>
  </div>

  <p class="error" *ngIf="error()">{{ error() }}</p>
</div>
