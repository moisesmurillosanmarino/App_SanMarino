<!-- src/app/features/config/user-management/user-management.component.html -->
<div class="user-management-container" [attr.aria-busy]="loading ? 'true' : null">
  <!-- Sidebar -->
  <app-sidebar class="sidebar"></app-sidebar>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Compact Header -->
    <div class="header">
      <div class="header-left">
        <fa-icon [icon]="faUsers" class="header-icon"></fa-icon>
        <h1 class="header-title">Gestión de Usuarios</h1>
      </div>
      <button
        (click)="navigateToCreate()"
        class="btn-create"
        aria-label="Registrar nuevo usuario"
      >
        <fa-icon [icon]="faUserPlus"></fa-icon>
        <span class="btn-text">Nuevo Usuario</span>
      </button>
    </div>

    <!-- Content Area -->
    <div class="content-area">
      <!-- Tabla de Lista de Registros -->
      <app-tabla-lista-registro
        *ngIf="currentPage === 'list'"
        class="table-container"
        (createUser)="navigateToCreate()"
        (editUser)="navigateToEdit($event)"
        (assignFarms)="navigateToAssignFarms($event)"
      ></app-tabla-lista-registro>

      <!-- Formulario de Creación -->
      <div *ngIf="currentPage === 'create'" class="form-container">
        <div class="form-header">
          <h2>Registrar Nuevo Usuario</h2>
          <button (click)="navigateToList()" class="btn-cancel">
            <fa-icon [icon]="faTimes"></fa-icon>
            Cancelar
          </button>
        </div>
        <div class="form-placeholder">
          <p>Formulario de registro de usuario (pendiente de implementar)</p>
        </div>
      </div>

      <!-- Formulario de Edición -->
      <div *ngIf="currentPage === 'edit'" class="form-container">
        <div class="form-header">
          <h2>Editar Usuario</h2>
          <button (click)="navigateToList()" class="btn-cancel">
            <fa-icon [icon]="faTimes"></fa-icon>
            Cancelar
          </button>
        </div>
        <div class="form-placeholder">
          <p>Formulario de edición de usuario (pendiente de implementar)</p>
          <p>Usuario ID: {{ selectedUserId }}</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Crear/Editar Usuario -->
<app-modal-create-edit
  [isOpen]="modalOpen"
  [editingUser]="editingUser"
  (close)="closeModal()"
  (userSaved)="onUserSaved($event)"
></app-modal-create-edit>

<!-- Modal de Asignación de Granjas -->
<app-asignar-usuario-granja
  *ngIf="selectedUserForFarms"
  [isOpen]="farmModalOpen"
  [userId]="selectedUserForFarms.id"
  [userName]="selectedUserForFarms.firstName + ' ' + selectedUserForFarms.surName"
  [companyId]="getUserCompanyId(selectedUserForFarms)"
  (close)="closeFarmModal()"
  (granjasUpdated)="onFarmsUpdated()"
></app-asignar-usuario-granja>