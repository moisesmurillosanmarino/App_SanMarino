<!-- ================= TABLA DE INDICADORES SEMANALES ================= -->
<div class="indicadores-container">
  <div class="indicadores-header">
    <h3>Indicadores Semanales</h3>
    <button 
      (click)="validarUsoTablaGenetica()" 
      class="btn-validation"
      [disabled]="!selectedLote || indicadoresSemanales.length === 0">
      üîç Validar Tabla Gen√©tica
    </button>
  </div>
  
  <div class="ux-scroll">
    <table class="ux-table indicadores-table">
      <thead>
        <tr>
          <th rowspan="2">Semana</th>
          <th rowspan="2">Per√≠odo</th>
          <th rowspan="2">Aves Inicio</th>
          <th rowspan="2">Aves Fin</th>
          <th colspan="2">Consumo</th>
          <th rowspan="2">Conv. Alimenticia</th>
          <th colspan="2">Ganancia</th>
          <th colspan="3">Mortalidad & Selecci√≥n</th>
          <th rowspan="2">Eficiencia</th>
          <th rowspan="2">IP</th>
          <th rowspan="2">VPI</th>
          <th rowspan="2">Piso T√©rmico</th>
        </tr>
        <tr>
          <th>Real (g)</th>
          <th>Tabla (g)</th>
          <th>Semana (g)</th>
          <th>Diaria (g)</th>
          <th>Mort. %</th>
          <th>Sel. %</th>
          <th>Total %</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="!indicadoresSemanales || indicadoresSemanales.length === 0">
          <td colspan="16" class="empty-state">
            <div class="empty-illustration" aria-hidden="true">üìä</div>
            <p>No hay datos de indicadores disponibles.</p>
          </td>
        </tr>

        <tr *ngFor="let ind of indicadoresSemanales" class="indicador-row">
          <td class="semana-cell">{{ ind.semana }}</td>
          <td class="periodo-cell">
            {{ formatDate(ind.fechaInicio) }} - {{ formatDate(ind.fechaFin) }}
          </td>
          <td>{{ ind.avesInicioSemana | number:'1.0-0' }}</td>
          <td>{{ ind.avesFinSemana | number:'1.0-0' }}</td>
          <td class="consumo-real" 
              [class]="'consumo-' + validarConsumo(ind.consumoReal, ind.consumoTabla).tipo">
            {{ formatNumber(ind.consumoReal, 1) }}
            <span class="alert-icon" 
                  [title]="validarConsumo(ind.consumoReal, ind.consumoTabla).mensaje"
                  *ngIf="!validarConsumo(ind.consumoReal, ind.consumoTabla).esValido">
              ‚ö†Ô∏è
            </span>
          </td>
          <td>{{ formatNumber(ind.consumoTabla, 1) }}</td>
          <td>{{ formatNumber(ind.conversionAlimenticia, 2) }}</td>
          <td class="ganancia-semana" 
              [class]="'ganancia-' + validarGanancia(ind.gananciaSemana, ind.semana).tipo">
            {{ formatNumber(ind.gananciaSemana, 2) }}
            <span class="alert-icon" 
                  [title]="validarGanancia(ind.gananciaSemana, ind.semana).mensaje"
                  *ngIf="!validarGanancia(ind.gananciaSemana, ind.semana).esValido">
              ‚ö†Ô∏è
            </span>
          </td>
          <td>{{ formatNumber(ind.gananciaDiariaAcumulada, 2) }}</td>
          <td class="mortalidad-semana" 
              [class]="'mortalidad-' + validarMortalidad(ind.mortalidadSem, ind.semana).tipo">
            {{ formatPercentage(ind.mortalidadSem) }}
            <span class="alert-icon" 
                  [title]="validarMortalidad(ind.mortalidadSem, ind.semana).mensaje"
                  *ngIf="!validarMortalidad(ind.mortalidadSem, ind.semana).esValido">
              ‚ö†Ô∏è
            </span>
          </td>
          <td>{{ formatPercentage(ind.seleccionSem) }}</td>
          <td>{{ formatPercentage(ind.mortalidadMasSeleccion) }}</td>
          <td>{{ formatNumber(ind.eficiencia, 2) }}</td>
          <td>{{ formatNumber(ind.ip, 2) }}</td>
          <td>{{ formatNumber(ind.vpi, 2) }}</td>
          <td class="piso-termico">
            <span class="badge" [class.visible]="ind.pisoTermicoVisible">
              {{ ind.pisoTermicoVisible ? 'S√≠' : 'No' }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Resumen de Acumulados -->
  <div class="acumulados-section" *ngIf="indicadoresSemanales.length > 0">
    <h4>Resumen Acumulado</h4>
    <div class="acumulados-grid">
      <div class="acumulado-card">
        <h5>Mortalidad Acumulada</h5>
        <p>{{ formatPercentage(indicadoresSemanales[indicadoresSemanales.length - 1].mortalidadAcum || 0) }}</p>
      </div>
      <div class="acumulado-card">
        <h5>Selecci√≥n Acumulada</h5>
        <p>{{ formatPercentage(indicadoresSemanales[indicadoresSemanales.length - 1].seleccionAcum || 0) }}</p>
      </div>
      <div class="acumulado-card">
        <h5>Total Mort. + Sel.</h5>
        <p>{{ formatPercentage(indicadoresSemanales[indicadoresSemanales.length - 1].mortalidadMasSeleccionAcum || 0) }}</p>
      </div>
    </div>
  </div>
</div>
